<!DOCTYPE html>
 <html lang="en">
 
 <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="static/assets/css/main.css" />
    <link rel='stylesheet prefetch' href='https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.4/css/bootstrap.min.css'>
     <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css">
     <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.6/umd/popper.min.js"></script>
     <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js"></script>
     <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" integrity="sha512-dTfge/zgoMYpP7QbHy4gWMEGsbsdZeCXz7irItjcC3sPUFtf0kuFbDz/ixG7ArTxmDjLXDmezHubeNikyKGVyQ==" crossorigin="anonymous">
    <script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js" integrity="sha512-K1qjQ+NcF2TYO/eI3M6v8EiNYZfA95pQumfvcVrTHtwQVDG+aHRqLi/ETn2uB+1JqwYqVG3LIvdm9lj6imS/pQ==" crossorigin="anonymous"></script>

    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script type="text/javascript" src="{{url_for('static', filename='bootstrap-filestyle-2.1.0/src/bootstrap-filestyle.min.js')}}"></script>

    <script src="static/assets/js/jquery.min.js"></script>
    <script src="static/assets/js/jquery.poptrox.min.js"></script>
    <script src="static/assets/js/skel.min.js"></script>
    <script src="static/assets/js/main.js"></script>

    <script>

      var dir="";
      var Time;
      var vaild_code, invaild_code, pro_result ;

      $(function(){

        $('#file_submit').click(function(){
          event.preventDefault();
          var form_data=new FormData($('#uploadform')[0]);
          $.ajax({
            type:'POST',
            url:'/fileUpload',
            data:form_data,
            contentType:false,
            processData:false,
            dataType:'json',
            success: function(response){    

              pro_result=response.pr; 
              Time=response.Time;
              Re=response.re_lang
              console.log(Time)

              invaild_code=response.er;
              dir=response.dire;

              $('.buttonclass').empty();

              var button_html=`
                   <button type="button" id="result_btn" class="btn btn-primary" style="background-color: #0694F3;">결과</button>
                  <button type="button" id="pla_btn" class="btn btn-primary" style="background-color: #0694F3;"">유사도</button>
                  <button type="button" id="graph_bnt" class="btn btn-primary" style="background-color: #0694F3;"">그래프</button>`;

                  $('.buttonclass').append(button_html);

              $('.re').empty();
              var html='';
              html=html+`
                <table>
                  <tr> <td> 코드 개수 `+Re["NofCode"] + ` </td> </tr>`+ 
                    `<tr> <td> C  `+Re["NofC"]   + ` </td> </tr>`+
                    `<tr> <td> CPP `+Re["NofCPP"] + ` </td>`+
                    `<tr> <td> PYTHON ` +Re["NofPY"]  + ` </td> </tr>`+
                    `<tr> <td> JAVA ` +Re["NofJAVA"]+ ` </td> </tr>`+
                    `<tr> <td> Max Token Code `+Re["maxToken"]+" line --> " +Re["maxTokenCode"]+`</td></tr>`+
                  `</table>`



              html=html+`
              <br>
              <br>
              <p style="font-size:20px; color:#FE2E2E; bold; "> INVAILD CODE </p>`;

              for ( var i in invaild_code ){
                var temp='<input class="showcode" type="submit" id="er_code" value='+invaild_code[i]+'>';
                html=html+temp;
              }

              $('.re').append(html);

           },
            error: function(jqXHR, testStatus, errorThrown){
              console.log("error")
            }
          });

        });  // end of file submit


        $('#div1').on('click','#show_one_code',function(){
          event.preventDefault();
          var file1=$(this).val();
          var where_dir=dir;
          window.open('show_one_code?file1='+file1+'&where_dir='+where_dir,'__blank');

        });


        $('#div1').on('click','#score',function(){
          event.preventDefault();
          var $td= $(this).closest('tr').children('td');
          var file1= $td.eq(1).text();
          var  file2= $td.eq(3).text();
          var where_dir=dir;
          window.open('show_code?file1='+file1+'&file2='+file2+'&where_dir='+where_dir, '_blank'); 
        });

        $('#buttonclass').on('click','#result_btn',function(){
            $('.re').empty();
            var html='';
            html=html+`
                <table>
                  <tr> <td> 코드 개수 `+Re["NofCode"] + ` </td> </tr>`+ 
                    `<tr> <td> C  `+Re["NofC"]   + ` </td> </tr>`+
                    `<tr> <td> CPP `+Re["NofCPP"] + ` </td>`+
                    `<tr> <td> PYTHON ` +Re["NofPY"]  + ` </td> </tr>`+
                    `<tr> <td> JAVA ` +Re["NofJAVA"]+ ` </td> </tr>`+
                    `<tr> <td> Max Token Code `+Re["maxToken"]+" line --> " +Re["maxTokenCode"]+`</td></tr>`+
                  `</table>`



            html=html+`
              <br>
              <br>
              <p style="font-size:20px; color:#FE2E2E; bold; "> INVAILD CODE </p>`;

            for ( var i in invaild_code ){
              var temp='<input class="showcode" type="submit" id="er_code" value='+invaild_code[i]+'>';
              html=html+temp;
            }
            $('.re').append(html);
        });


      $('#buttonclass').on('click','#pla_btn',function(){
          event.preventDefault();
          $('.re').empty();

          var html="<barG> </barG>"
          $('.re').append(html);


          var data=pro_result;

        //sort bars based on value
          data = data.sort(function (a, b) {
              return d3.ascending(parseFloat(a.score), parseFloat(b.score));
          })

        //set up svg using margin conventions - we'll need plenty of room on the left for labels
        var margin = {
            top: 15,
            right: 25,
            bottom: 15,
            left: 60
        };

        var width = 1200 - margin.left - margin.right,
            height = 500 - margin.top - margin.bottom;

        var svg = d3.select("barG").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        var x = d3.scale.linear()
            .range([0, width])
            .domain([0, d3.max(data, function (d) {
                return d.score;
            })]);

        var y = d3.scale.ordinal()
            .rangeRoundBands([height, 0], .1)
            .domain(data.map(function (d) {
                return d.file1+"&"+d.file2;
            }));

        //make y axis to show bar names
        var yAxis = d3.svg.axis()
            .scale(y)
            //no tick marks
            .tickSize(0)
            .orient("left");

        var gy = svg.append("g")
            .attr("class", "y axis")
            .call(yAxis)

        var bars = svg.selectAll(".bar")
            .data(data)
            .enter()
            .append("g")

        //append rects
        bars.append("rect")
            .attr("class", "bar")
            .attr("y", function (d) {
                return y(d.file1+"&"+d.file2);
            })
            .attr("height", y.rangeBand())
            .attr("x", 0)
            .attr("width", function (d) {
                return x(d.score/(1.5));
            });

        //add a value label to the right of each bar
        bars.append("text")
            .attr("class", "label")
            //y position of the label is halfway down the bar
            .attr("y", function (d) {
                return y(d.file1+"&"+d.file2) + y.rangeBand() / 2 + 4;
            })
            //x position is 3 pixels to the right of the bar
            .attr("x", function (d) {
                return x(d.score/1.5) + 3;
            })
            .text(function (d) {
                return d.score;
            });

          // var pr=pro_result;

          // var data=[];

          // for( var i in pr){
          //   data.push(parseFloat(pr[i].score))
          // }

          // data.sort(function(a, b){return b-a});


          // var chart=d3.select("barG")
          //             .append("div")
          //             .attr("class","chart")



          // chart.selectAll("barG")
          //       .data(data)
          //       .enter().append("div")
          //       .style("width", function(d){ return d*10+"px"; })
          //       .style("height", function(d){ return 40+"px" })
          //       .attr("x", "hello")
          //       .text(function(d){ return d; })
          
          // var g=chart.append("div")
          //             .style("display", "inline")
          //             .text(function(d, i){return "label"+i; })



      });




      // $('#buttonclass').on('click','#pla_btn',function(){
      //     event.preventDefault();
      //     $('.re').empty();
      //     var pr=pro_result;
      //     var p_tag="";
      //     var array="";
      //     var array=`
      //       <table>
      //         <thead>
      //           <tr>
      //             <th><div style="margin-right:30px; font-size:20px;">No.    </div></th>
      //             <th><div style="margin-right:130px; font-size:20px;">File1  </div></th>
      //             <th><div style="margin-right:60px; font-size:20px;">Len1   </div></th>
      //             <th><div style="margin-right:130px; font-size:20px;">File2  </div></th>
      //             <th><div style="margin-right:60px; font-size:20px;">Len2   </div></th>
      //             <th><div style="margin-right:100px;font-size:20px;">Score </div></th>
      //           </tr>
      //         </thead>`;
      //     array=array+'<tbody>';

      //     for( var i in pr){
      //       temp='<tr>'+
      //       '<td>'+ pr[i].number + '</td>' +
      //       '<td>'+ pr[i].file1  + '</td>' +
      //       '<td>'+ pr[i].len1   + '</td>' +
      //       '<td>'+ pr[i].file2  +  '</td>' +
      //       '<td>'+ pr[i].len2   + '</td>' +
      //       '<td>'+ '<input style="margin-right:100px; background: #ffffff; border: 0px;" type="submit" id="score"  value= '+pr[i].score+ '>  </td>' +
      //       '</tr>' ;
      //       array=array+temp;
      //     }

      //     array=array+ `
      //       </tbody>
      //       </table> `;
      //     $('.re').append(array);

      // });


      $('#buttonclass').on('click','#graph_bnt',function(){
                    event.preventDefault();
            window.open('show_graph'); 
        });

    });






      
    </script>


     <style>

        @import url(http://fonts.googleapis.com/earlyaccess/nanumgothic.css);

         html, body{height:100%;  }
         body{
              font-weight: bold;
            /*font-family: "Nanum Gothic", sans-serif;*/
         }


        .btn.sharp {
          border-radius:0;
        }

        .re{
          margin-left: 20px;
          padding-top: 10px;
          padding-bottom: 15px;
          padding-right: 40px;
          padding-left: 40px;
/*          background-color:#ffffff;*/
/*          opacity: 0.3;*/

        }

        .table_style{
          margin-top:10px; 
          margin-right:30px; 
          font-size:15px; 
          text-align:right
        }

        .showcode{
          font-size:15; 
          display: inline-block; 
          background: #ffffff; 
          border: 0px;
        }

        input[type='file']::-webkit-file-upload-button
        {
          padding: 3px 7px;
          color:black;
          font-size:15px;
          border-radius:3px;
          background-color: #F2F2F2;
          border: none;
        }

        .bar{
          font: 10px;
          text-align: right;
          fill:orange;          
          color: white;
          padding:10px;
          margin:5px;
        }

        .bar:hover {
          fill:orangered;
        }


 

     </style>


 </head> 

 <body>

    <div id="wrapper">
      <header id="header">
        <h1 style="font-size: 50px;"> LEECH</h1>
      </header>

      <br><br>

      <section id="main">

          <form id="uploadform" method="post">
            <input name="file" type="file" style="background-color: #ffffff; opacity:0.7;" >
            <br><br>
            <label>TOKEN</label>
            <select name="token" style="width:200px; margin:10px; display:inline-block;">
              <option value="rich">RICH</option>
              <option value="medium">MEDIUM</option>
              <option value="small">SMALL</option>
            </select>

            <label style="margin-left: 15px;">ADAPTIVE</label>
            <select name="adaptive" style="width:200px; margin:10px;display:inline-block;">
              <option value="on">ON</option>
              <option value="off">OFF</option>
            </select>

            <button id="file_submit" type="button" style="background-color: #0694F3; margin:20px; display:inline-block;">RUN</button>
          
          </form>

          <br><br>

            <div class="btn-group btn-lg">
              <div class="buttonclass" id="buttonclass">
<!--               <button type="button" id="result_btn" class="btn btn-default sharp">결과</button>
              <button type="button" id="pla_btn" class="btn btn-default sharp">유사도</button>
              <button type="button" id="graph_bnt" class="btn btn-default sharp">그래프</button> -->
              </div>
            </div>


        <div class="re" id="div1">
        </div>

      </section>

      <footer id="footer">
        <p>달려라 한이</p>
      </footer>
    </div>

   
 </body>
</html>

